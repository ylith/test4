<!DOCTYPE html>

<html>
	<head>
		<title>Тест 4</title>
		<meta charset="utf-8">
		
		<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">

		<script src="three.min.js"></script>
		<script src="OrbitControls.js"></script>
		<script src="WebGL.js"></script>
		<script src="vax.js"></script>
		<script src="lights.js"></script>
		<script src="utils.js"></script>
	</head>
	
	<body>
		<script>
			vaxInit();
			
			camera.fov = 30;
			onWindowResize();
	
			// var controls = new THREE.OrbitControls( camera, renderer.domElement );
			// 	controls.enableZoom = false;
			// 	controls.enablePan = false;
			// 	controls.enableDamping = true;
			// 	controls.minPolarAngle = 0.1;
			// 	controls.maxPolarAngle = Math.PI - 0.1;
			// 	controls.dampingFactor = 0.1;

			
			setupLights(scene);

			//lights
			const ambient = new THREE.AmbientLight( 0xffffff );
			scene.add( ambient );

			pointLight = new THREE.PointLight( 0xffffff, 5 );
			scene.add( pointLight );

			const cubeMapUrls = [
				'cube/posx.jpg', 'cube/negx.jpg',
				'cube/posy.jpg', 'cube/negy.jpg',
				'cube/posz.jpg', 'cube/negz.jpg' ];
			const background = new THREE.CubeTextureLoader().load( cubeMapUrls );
			scene.background = background;
			const refractionCube = new THREE.CubeTextureLoader().load( cubeMapUrls );
			refractionCube.mapping = THREE.CubeRefractionMapping;
			refractionCube.anisotropy = renderer.getMaxAnisotropy();
			

			// const cubeMaterial3 = new THREE.MeshLambertMaterial( { color: 0xffffff, envMap: background, combine: THREE.MixOperation, reflectivity: 0.3 } );
			// const cubeMaterial2 = new THREE.MeshLambertMaterial( { color: 0xffffff, envMap: refractionCube, refractionRatio: 0.95 } );
			// const cubeMaterial1 = new THREE.MeshLambertMaterial( { color: 0xffffff, envMap: background } );
							
			const cubeMaterial4 = new THREE.MeshBasicMaterial( { color: 0xffffff, envMap: refractionCube, reflectivity: 1, refractionRatio: 0.95, opacity:0.7, transparent:true, combine: THREE.MixOperation } );
			// const cubeMaterial1 = new THREE.MeshLambertMaterial( {color: 0xffffff, shininess: 100, envMap: refractionCube, reflectivity: 1, refractionRatio: 0.95, opacity:0.7, transparent:true} );



			spawnCrystals(50, scene);

			// наклон
			var slopeX = 0,
				slopeY = 0;

			// слушаме за събитието на ориентацията на устройство
			window.addEventListener( "deviceorientation", deviceOrientation, true);

			var alpha = 0,
				gamma = 0;

			// функция, която търкаля топката според наклона на устройството
			function deviceOrientation( event )
			{
				// взимаме ъглите
				alpha = event.alpha,
				gamma = event.gamma;

				if( alpha === null ) return;
				
				// // поправяме ги, за да ни е удобно
				// if( gamma>=0 )
				// 	gamma = 90-gamma;
				// else
				// {
				// 	alpha = alpha+180;
				// 	gamma = -90-gamma;
				// }
									
				// правим ги на радиани
				alpha = THREE.Math.degToRad( alpha );
				gamma = THREE.Math.degToRad( gamma );
				
				// въртим камерата
				camera.rotation.set( gamma, alpha, 0, 'YZX' );
			}

			function animate()
			{
				// controls.update();
				// camera.rotation
				// camera.rotateX(slopeX);
				// camera.rotateY(slopeY);
			}
			
		</script>
		
	</body>
</html>


